<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è¸©åœ°é›·</title>
<style>
  body, button, div, span, li, input {
    background-color: #FFFFFF;
    font-size: 18px;
    font-weight: bold;
    color: #333;
    font-family: sans-serif;
    font-style: normal;
  }
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 10px;
    touch-action: manipulation;
  }
  #game-container {
    text-align: center;
    width: 320px;
  }
  
  #playerName {
    width: 100%;
    box-sizing: border-box;
    padding: 8px;
    margin-bottom: 15px;
    border: 2px solid #333;
    text-align: center;
  }
  
  .status-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    padding: 0 5px;
  }

  /* è¸©åœ°é›·ç¶²æ ¼ */
  #minesweeper-board {
    display: grid;
    grid-template-columns: repeat(9, 32px);
    grid-template-rows: repeat(9, 32px);
    gap: 2px;
    justify-content: center;
    margin-bottom: 15px;
  }
  
  .cell {
    width: 32px;
    height: 32px;
    background-color: #E8E8E8; /* æœªæŒ‰éçš„æ ¼å­ï¼šæ·ºç°è‰² */
    border: 2px solid #333;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    user-select: none;
  }
  
  /* æ»‘é¼ æ‡¸åœæ•ˆæœï¼Œè®“æœªæŒ‰éçš„æ ¼å­æœ‰äº’å‹•æ„Ÿ */
  .cell:not(.revealed):hover {
    background-color: #D0D0D0; 
  }
  
  .cell.revealed {
    border: 1px solid #CCC;
    background-color: #FFFFFF; /* å·²æŒ‰éçš„æ ¼å­ï¼šç´”ç™½è‰² */
  }

  .brand-label {
    margin-top: 20px;
    margin-bottom: 10px;
  }

  .action-btn {
    margin-top: 10px;
    padding: 10px;
    border: 2px solid #333;
    cursor: pointer;
    width: 100%;
  }
  .action-btn:active {
    color: #888;
    border-color: #888;
  }

  /* æ’è¡Œæ¦œ */
  #scoreboard {
    margin-top: 30px;
    border-top: 2px solid #333;
    padding-top: 15px;
    text-align: left;
  }
  .score-title {
    text-align: center;
    margin-bottom: 15px;
  }
  #score-list {
    list-style-type: none;
    padding: 0;
    margin: 0;
  }
  .score-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    border-bottom: 1px dashed #CCC;
    padding-bottom: 4px;
    font-size: 16px;
  }
  
  .delete-btn {
    border: 1px solid #333;
    color: #333;
    background-color: #FFFFFF;
    cursor: pointer;
    font-size: 14px;
    margin-left: 10px;
    padding: 2px 6px;
  }
  .delete-btn:active {
    color: #888;
    border-color: #888;
  }
</style>
</head>
<body>

<div id="game-container">
  <input type="text" id="playerName" placeholder="è«‹è¼¸å…¥ç©å®¶åç¨±" value="åŒ¿åç©å®¶">
  
  <div class="status-bar">
    <span>ğŸ’£ å‰©é¤˜: <span id="mine-count">10</span></span>
    <span>â±ï¸ æ™‚é–“: <span id="timer">0</span> ç§’</span>
  </div>
  
  <div id="minesweeper-board" oncontextmenu="event.preventDefault();"></div>
  
  <button id="mode-toggle" class="action-btn" onclick="toggleMode()">ç›®å‰æ¨¡å¼ï¼šâ›ï¸ æŒ–æ˜</button>
  <button class="action-btn" onclick="initGame()">é‡æ–°é–‹å§‹</button>

  <div class="brand-label">å°ç‹¸è€å¸«æ•´ç†</div>

  <div id="scoreboard">
    <div class="score-title">æ­·å²æœ€é€Ÿç´€éŒ„ (9x9)</div>
    <ul id="score-list">
    </ul>
  </div>
</div>

<script>
  const ROWS = 9;
  const COLS = 9;
  const TOTAL_MINES = 10;
  
  let board = [];
  let revealedCount = 0;
  let flagCount = 0;
  let isGameOver = false;
  let isFirstClick = true;
  
  let timerInterval;
  let seconds = 0;
  
  let isDigMode = true; 

  function initGame() {
    clearInterval(timerInterval);
    seconds = 0;
    document.getElementById('timer').innerText = seconds;
    
    revealedCount = 0;
    flagCount = 0;
    isGameOver = false;
    isFirstClick = true;
    updateMineCountDisplay();
    
    board = [];
    for (let r = 0; r < ROWS; r++) {
      let row = [];
      for (let c = 0; c < COLS; c++) {
        row.push({
          r: r,
          c: c,
          isMine: false,
          revealed: false,
          flagged: false,
          neighborMines: 0
        });
      }
      board.push(row);
    }
    
    renderBoard();
    updateScoreBoard();
  }

  function placeMines(firstR, firstC) {
    let minesPlaced = 0;
    while (minesPlaced < TOTAL_MINES) {
      let r = Math.floor(Math.random() * ROWS);
      let c = Math.floor(Math.random() * COLS);
      
      if (!board[r][c].isMine && Math.abs(r - firstR) > 1 && Math.abs(c - firstC) > 1) {
        board[r][c].isMine = true;
        minesPlaced++;
      }
    }
    calculateNeighbors();
  }

  function calculateNeighbors() {
    for (let r = 0; r < ROWS; r++) {
      for (let c = 0; c < COLS; c++) {
        if (board[r][c].isMine) continue;
        let count = 0;
        for (let dr = -1; dr <= 1; dr++) {
          for (let dc = -1; dc <= 1; dc++) {
            let nr = r + dr;
            let nc = c + dc;
            if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS && board[nr][nc].isMine) {
              count++;
            }
          }
        }
        board[r][c].neighborMines = count;
      }
    }
  }

  function renderBoard() {
    const boardElement = document.getElementById('minesweeper-board');
    boardElement.innerHTML = '';
    
    for (let r = 0; r < ROWS; r++) {
      for (let c = 0; c < COLS; c++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.r = r;
        cell.dataset.c = c;
        
        cell.addEventListener('click', () => handleCellClick(r, c));
        cell.addEventListener('contextmenu', (e) => {
          e.preventDefault();
          if (!isGameOver) toggleFlag(r, c);
        });
        
        boardElement.appendChild(cell);
      }
    }
  }

  function updateCellUI(r, c) {
    const cellData = board[r][c];
    const index = r * COLS + c;
    const cellElement = document.getElementById('minesweeper-board').children[index];
    
    if (cellData.revealed) {
      cellElement.classList.add('revealed');
      if (cellData.isMine) {
        cellElement.innerText = 'ğŸ’£';
      } else if (cellData.neighborMines > 0) {
        cellElement.innerText = cellData.neighborMines;
        cellElement.style.color = getNumberColor(cellData.neighborMines);
      } else {
        cellElement.innerText = '';
      }
    } else {
      cellElement.classList.remove('revealed');
      cellElement.innerText = cellData.flagged ? 'ğŸš©' : '';
    }
  }

  function getNumberColor(num) {
    const colors = ['#333', '#333', '#333', '#333', '#333', '#333', '#333', '#333'];
    return colors[num - 1] || '#333';
  }

  function handleCellClick(r, c) {
    if (document.activeElement.id === 'playerName') {
      document.activeElement.blur();
    }

    if (isGameOver) return;
    
    if (!isDigMode) {
      toggleFlag(r, c);
      return;
    }
    
    revealCell(r, c);
  }

  function toggleFlag(r, c) {
    let cellData = board[r][c];
    if (cellData.revealed) return;
    
    if (!cellData.flagged) {
      if (flagCount >= TOTAL_MINES) return; 
      cellData.flagged = true;
      flagCount++;
    } else {
      cellData.flagged = false;
      flagCount--;
    }
    updateCellUI(r, c);
    updateMineCountDisplay();
  }

  function revealCell(r, c) {
    let cellData = board[r][c];
    if (cellData.revealed || cellData.flagged) return;
    
    if (isFirstClick) {
      isFirstClick = false;
      placeMines(r, c);
      timerInterval = setInterval(() => {
        seconds++;
        document.getElementById('timer').innerText = seconds;
      }, 1000);
    }
    
    cellData.revealed = true;
    revealedCount++;
    updateCellUI(r, c);
    
    if (cellData.isMine) {
      gameOver(false);
      return;
    }
    
    if (cellData.neighborMines === 0) {
      for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
          let nr = r + dr;
          let nc = c + dc;
          if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
            revealCell(nr, nc);
          }
        }
      }
    }
    
    checkWin();
  }

  function toggleMode() {
    isDigMode = !isDigMode;
    const btn = document.getElementById('mode-toggle');
    btn.innerText = isDigMode ? "ç›®å‰æ¨¡å¼ï¼šâ›ï¸ æŒ–æ˜" : "ç›®å‰æ¨¡å¼ï¼šğŸš© æ’æ——";
  }

  function updateMineCountDisplay() {
    document.getElementById('mine-count').innerText = TOTAL_MINES - flagCount;
  }

  function checkWin() {
    if (revealedCount === (ROWS * COLS) - TOTAL_MINES) {
      gameOver(true);
    }
  }

  function gameOver(isWin) {
    isGameOver = true;
    clearInterval(timerInterval);
    
    for (let r = 0; r < ROWS; r++) {
      for (let c = 0; c < COLS; c++) {
        if (board[r][c].isMine) {
          board[r][c].revealed = true;
          updateCellUI(r, c);
        }
      }
    }
    
    setTimeout(() => {
      if (isWin) {
        alert("æ­å–œéé—œï¼æ‚¨çš„æ™‚é–“æ˜¯ï¼š" + seconds + " ç§’");
        saveRecord(seconds);
      } else {
        alert("è¸©åˆ°åœ°é›·äº†ï¼éŠæˆ²çµæŸã€‚");
      }
    }, 100);
  }

  function saveRecord(timeRecord) {
    const playerName = document.getElementById('playerName').value || 'åŒ¿åç©å®¶';
    const now = new Date();
    const dateStr = now.getFullYear() + '/' + 
                    String(now.getMonth() + 1).padStart(2, '0') + '/' + 
                    String(now.getDate()).padStart(2, '0') + ' ' + 
                    String(now.getHours()).padStart(2, '0') + ':' + 
                    String(now.getMinutes()).padStart(2, '0');
                    
    const newRecord = { name: playerName, time: timeRecord, date: dateStr };
    let records = JSON.parse(localStorage.getItem('minesweeperRecords')) || [];
    
    records.push(newRecord);
    records.sort(function(a, b) { return a.time - b.time; });
    records = records.slice(0, 5); 
    
    localStorage.setItem('minesweeperRecords', JSON.stringify(records));
    updateScoreBoard();
  }

  function updateScoreBoard() {
    const scoreList = document.getElementById('score-list');
    let records = JSON.parse(localStorage.getItem('minesweeperRecords')) || [];
    scoreList.innerHTML = '';
    
    if (records.length === 0) {
      scoreList.innerHTML = '<li style="text-align:center; color:#888; border:none; padding-top:10px;">æš«ç„¡ç´€éŒ„</li>';
      return;
    }
    
    records.forEach(function(record, index) {
      const li = document.createElement('li');
      li.className = 'score-item';
      li.innerHTML = `
        <span>${index + 1}. ${record.name} (${record.time}ç§’)</span>
        <span>${record.date} <button class="delete-btn" onclick="deleteRecord(${index})">åˆªé™¤</button></span>
      `;
      scoreList.appendChild(li);
    });
  }

  function deleteRecord(index) {
    let records = JSON.parse(localStorage.getItem('minesweeperRecords')) || [];
    records.splice(index, 1);
    localStorage.setItem('minesweeperRecords', JSON.stringify(records));
    updateScoreBoard();
  }

  document.getElementById('playerName').addEventListener('keydown', function(event) {
    if (event.keyCode === 13) {
      this.blur();
    }
  });

  initGame();
</script>
</body>
</html>
